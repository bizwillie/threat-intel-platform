"""
Pydantic schemas for vulnerability scan requests and responses.
"""

from pydantic import BaseModel, Field
from typing import List, Optional
from datetime import datetime


class VulnScanResponse(BaseModel):
    """Response after uploading a vulnerability scan."""
    scan_id: str
    filename: str
    scan_date: datetime
    uploaded_by: str
    vulnerability_count: int
    unique_cve_count: int
    technique_count: int


class VulnScanSummary(BaseModel):
    """Summary information for a vulnerability scan."""
    scan_id: str
    filename: str
    scan_date: datetime
    uploaded_by: str
    created_at: datetime
    vulnerability_count: int
    unique_cve_count: int


class VulnScanListResponse(BaseModel):
    """List of vulnerability scans."""
    scans: List[VulnScanSummary]
    total: int


class VulnerabilityDetail(BaseModel):
    """Detailed vulnerability information."""
    cve_id: str
    severity: str
    cvss_score: Optional[float]
    asset: str
    port: Optional[str]
    plugin_id: Optional[str]
    plugin_name: Optional[str]


class TechniqueMapping(BaseModel):
    """CVE to MITRE ATT&CK technique mapping."""
    technique_id: str
    confidence: float
    source_cves: List[str]


class VulnScanDetailResponse(BaseModel):
    """Detailed vulnerability scan with all data."""
    scan_id: str
    filename: str
    scan_date: datetime
    uploaded_by: str
    created_at: datetime
    vulnerabilities: List[VulnerabilityDetail]
    techniques: List[TechniqueMapping]
    total_vulnerabilities: int
    total_techniques: int


class TechniqueWithColor(BaseModel):
    """Technique with color coding for layer visualization."""
    technique_id: str
    confidence: float
    color: str  # "blue", "yellow", or "red"
    source_cves: List[str]


class TechniqueListResponse(BaseModel):
    """List of techniques from a scan (blue layer)."""
    scan_id: str
    techniques: List[TechniqueWithColor]
    total: int
