<div class="dashboard-container">
  <!-- Top Navigation Bar -->
  <div class="top-bar">
    <div class="top-bar-left">
      <h1 class="app-title">UTIP</h1>
      <span class="classification-label">INTERNAL USE ONLY</span>
    </div>

    <div class="top-bar-center">
      <span class="page-title">Dashboard</span>
    </div>

    <div class="top-bar-right">
      <button class="btn-icon" (click)="openNavigator()" title="ATT&CK Navigator">
        <span class="icon">ğŸ—ºï¸</span>
        <span class="btn-label">Navigator</span>
      </button>
      <button class="btn-icon" title="Upload Intel" disabled>
        <span class="icon">ğŸ“„</span>
        <span class="btn-label">Intel</span>
      </button>
      <button class="btn-icon" title="Upload Scan" disabled>
        <span class="icon">ğŸ”</span>
        <span class="btn-label">Scans</span>
      </button>
      <button class="btn-icon" (click)="logout()" title="Logout">
        <span class="icon">ğŸšª</span>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="dashboard-content">
    <!-- Welcome Section -->
    <div class="welcome-section glass-card">
      <h2>Welcome to UTIP</h2>
      <p class="text-secondary">
        Unified Threat Intelligence Platform - Mission-Critical Cybersecurity Fusion
      </p>
      <p class="user-greeting" *ngIf="currentUser$ | async as user">
        Logged in as: <strong>{{ user.username }}</strong>
      </p>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
      <!-- Skeleton loaders while loading -->
      <ng-container *ngIf="loading">
        <app-skeleton-loader type="stat-card"></app-skeleton-loader>
        <app-skeleton-loader type="stat-card"></app-skeleton-loader>
        <app-skeleton-loader type="stat-card"></app-skeleton-loader>
        <app-skeleton-loader type="stat-card"></app-skeleton-loader>
      </ng-container>

      <!-- Actual stat cards when loaded -->
      <ng-container *ngIf="!loading">
        <div class="stat-card glass-card">
          <div class="stat-icon">ğŸ—ºï¸</div>
          <div class="stat-info">
            <div class="stat-value">{{ stats.totalLayers }}</div>
            <div class="stat-label">ATT&CK Layers</div>
          </div>
        </div>

        <div class="stat-card glass-card">
          <div class="stat-icon">ğŸ“„</div>
          <div class="stat-info">
            <div class="stat-value">{{ stats.totalReports }}</div>
            <div class="stat-label">Threat Reports</div>
          </div>
        </div>

        <div class="stat-card glass-card">
          <div class="stat-icon">ğŸ”</div>
          <div class="stat-info">
            <div class="stat-value">{{ stats.totalScans }}</div>
            <div class="stat-label">Vulnerability Scans</div>
          </div>
        </div>

        <div class="stat-card glass-card">
          <div class="stat-icon">ğŸ¯</div>
          <div class="stat-info">
            <div class="stat-value">{{ stats.criticalTechniques }}</div>
            <div class="stat-label">Critical Techniques</div>
          </div>
        </div>
      </ng-container>
    </div>

    <!-- Recent Layers Section -->
    <div class="recent-section">
      <div class="section-header">
        <h3>Recent ATT&CK Layers</h3>

        <!-- Search and Filter Controls -->
        <div class="layers-controls" *ngIf="!loading && recentLayers.length > 0">
          <input
            type="search"
            placeholder="Search layers..."
            [(ngModel)]="searchTerm"
            class="search-input"
          >
          <select [(ngModel)]="filterBy" class="filter-select">
            <option value="all">All Layers</option>
            <option value="mine">My Layers</option>
          </select>
          <select [(ngModel)]="sortBy" class="sort-select">
            <option value="date-desc">Newest First</option>
            <option value="date-asc">Oldest First</option>
            <option value="name-asc">Name A-Z</option>
          </select>
        </div>
      </div>

      <!-- Skeleton loaders while loading -->
      <div class="layers-grid" *ngIf="loading">
        <app-skeleton-loader type="card"></app-skeleton-loader>
        <app-skeleton-loader type="card"></app-skeleton-loader>
        <app-skeleton-loader type="card"></app-skeleton-loader>
      </div>

      <!-- Actual layer cards when loaded -->
      <div class="layers-grid" *ngIf="!loading && filteredLayers.length > 0">
        <div
          *ngFor="let layer of filteredLayers"
          class="layer-card glass-card"
          (click)="openLayer(layer.id)"
        >
          <h4>{{ layer.name }}</h4>
          <p class="layer-meta text-secondary">
            Created: {{ layer.created_at | date:'short' }}
          </p>
          <p class="layer-meta text-secondary">
            By: {{ layer.created_by }}
          </p>
          <div class="layer-actions">
            <button class="btn-small">Open</button>
          </div>
        </div>
      </div>

      <!-- Enhanced Empty State -->
      <div class="empty-state-enhanced" *ngIf="!loading && recentLayers.length === 0">
        <div class="empty-icon">ğŸ—ºï¸</div>
        <h3>No Layers Yet</h3>
        <p class="text-secondary">Start by uploading threat intel and vulnerability scans</p>
        <div class="empty-actions">
          <button class="btn-primary" disabled>
            <span class="icon">ğŸ“„</span>
            Upload Intel Report
          </button>
          <button class="btn-secondary" disabled>
            <span class="icon">ğŸ”</span>
            Upload Vuln Scan
          </button>
        </div>
      </div>

      <!-- No Search Results State -->
      <div class="empty-state-enhanced" *ngIf="!loading && recentLayers.length > 0 && filteredLayers.length === 0">
        <div class="empty-icon">ğŸ”</div>
        <h3>No Matching Layers</h3>
        <p class="text-secondary">Try adjusting your search or filters</p>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h3>Quick Actions</h3>
      <div class="actions-grid">
        <button class="action-card glass-card" (click)="openNavigator()">
          <div class="action-icon">ğŸ—ºï¸</div>
          <div class="action-title">Open Navigator</div>
          <div class="action-description text-secondary">
            View and analyze ATT&CK layers
          </div>
        </button>

        <button class="action-card glass-card" disabled>
          <div class="action-icon">â•</div>
          <div class="action-title">Generate Layer</div>
          <div class="action-description text-secondary">
            Create new layer from intel and vulns
          </div>
        </button>

        <button class="action-card glass-card" disabled>
          <div class="action-icon">ğŸ“„</div>
          <div class="action-title">Upload Intel</div>
          <div class="action-description text-secondary">
            Upload threat intelligence reports
          </div>
        </button>

        <button class="action-card glass-card" disabled>
          <div class="action-icon">ğŸ”</div>
          <div class="action-title">Upload Scan</div>
          <div class="action-description text-secondary">
            Upload vulnerability scan results
          </div>
        </button>
      </div>
    </div>

    <!-- Footer -->
    <div class="dashboard-footer">
      <p class="text-tertiary font-mono">
        Theme: Midnight Vulture | Classification: INTERNAL USE ONLY | UTIP v1.0.0
      </p>
    </div>
  </div>
</div>
